<?xml version="1.0" encoding="iso-8859-1"?>
<root version="2.0">
	<template name="combattrackerffsource">
		<genericcontrol>
			<script>
				function onInit()
					setHoverCursor("hand");
				end
			
				function onDrag(button, x, y, draginfo)
					draginfo.setType("combattrackerff");

					draginfo.setIcon(icon[1]);
					draginfo.setStringData(value[1]);

					return true;
				end
			</script>
		</genericcontrol>
	</template>

	<windowclass name="combattracker_effect">
		<sizelimits>
			<minimum>
				<height>22</height>
			</minimum>
		</sizelimits>
		<sheetdata>
			<stringcontrol name="label">
				<bounds>0,4,75,17</bounds>
				<font>sheettextsmall</font>
				<frame>
					<name>textline</name>
					<offset>0,1,0,0</offset>
				</frame>
				<tabtarget>
					<next>duration</next>
					<prev>adjustment</prev>
				</tabtarget>
				<script>
					function onDeleteUp()
						if #(window.windowlist.getWindows()) &gt; 1 then
							window.close();
						end
					end
					
					function onDeleteDown()
						if #(window.windowlist.getWindows()) &gt; 1 then
							window.close();
						end
					end


					function onGainFocus()
						if getValue() == "" then
							wasempty = true;
						else
							wasempty = false;
						end
					end
					
					function onValueChanged()
						window.windowlist.checkForEmpty();

						if wasempty then
							casterentry = window.windowlist.window.windowlist.getActiveEntry();
							if casterentry then
								window.caster.setSource(casterentry);
							end
							
							wasempty = false;
						end
					end
				</script>
			</stringcontrol>
			
			<numbercontrol name="duration">
				<anchored>
					<left>
						<parent>label</parent>
						<anchor>right</anchor>
					</left>
					<top>
						<anchor>top</anchor>
					</top>
					<size>
						<width>30</width>
						<height>22</height>
					</size>
				</anchored>
				<font>sheetnumbersmall</font>
				<frame>
					<name>bonus</name>
					<offset>2,2,2,1</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>2,2,2,2</offset>
				</keyeditframe>
				<tabtarget>
					<next>adjustment</next>
					<prev>label</prev>
				</tabtarget>
			</numbercontrol>
			<numbercontrol name="adjustment">
				<anchored>
					<left>
						<parent>duration</parent>
						<anchor>right</anchor>
					</left>
					<top>
						<anchor>top</anchor>
					</top>
					<size>
						<width>30</width>
						<height>22</height>
					</size>
				</anchored>
				<font>sheetnumbersmall</font>
				<hideonvalue>0</hideonvalue>
				<displaysign />
				<frame>
					<name>durationadjustment</name>
					<offset>2,2,2,2</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>2,2,2,2</offset>
				</keyeditframe>
				<droptypes>
					<type>combattrackerentry</type>
				</droptypes>
				<stateframe>
					<drophilight>
						<name>sheetfocus</name>
						<offset>2,2,2,2</offset>
					</drophilight>
				</stateframe>
				<tabtarget>
					<next>label</next>
					<prev>duration</prev>
				</tabtarget>
				<script>
					function onValueChanged()
						window.caster.updateVisibility();
					end
					
					function onDrop(x, y, draginfo)
						if draginfo.isType("combattrackerentry") then
							window.caster.setSource(draginfo.getCustomData());
							return true;
						end
					end
				</script>
			</numbercontrol>

			<stringcontrol name="caster">
				<anchored>
					<right>
						<parent>adjustment</parent>
						<anchor>right</anchor>
						<offset>-5</offset>
					</right>
					<top>
						<parent>duration</parent>
						<anchor>bottom</anchor>
					</top>
					<size>
						<height>12</height>
					</size>
				</anchored>
				<center />
				<static />
				<font>sheetlabelsmall</font>
				<color>#7f000000</color>
				<empty>&#171; unnamed &#187;</empty>
				<invisible />
				<script>
					function updateVisibility()
						if sourceentry and window.adjustment.getValue() ~= 0 then
							setVisible(true);
						else
							setVisible(false);
						end
					end
				
					function getSource()
						return sourceentry;
					end
				
					function setSource(entry)
						if sourceentry then
							sourceentry.removeObserver(self);
						end
					
						sourceentry = entry;
						
						if sourceentry then
							sourceentry.addObserver(self);
							setValue("Update on: " .. sourceentry.name.getValue());
							updateVisibility();
						else
							updateVisibility();
						end
					end
					
					function observedNameChanged(source)
						setValue("Update on: " .. sourceentry.name.getValue());
					end
					
					function observedClosed(source)
						if source == sourceentry then
							sourceentry = nil;
							setValue(nil);
							updateVisibility();
						end
					end
					
					function onClickDown(button, x, y)
						if button == 2 then
							setSource(nil);
						end
					end
					
					function onDrop(x, y, draginfo)
						if draginfo.isType("combattrackerentry") then
							setSource(draginfo.getCustomData());
							return true;
						end
					end
				</script>
			</stringcontrol>
		</sheetdata>
	</windowclass>

	<windowclass name="combattracker_entry">
		<frame>ctentrybox</frame>
		<sizelimits>
			<minimum>
				<height>40</height>
			</minimum>
		</sizelimits>
		<script file="scripts/combattracker_entry.lua" />
		<sheetdata>
			<!-- Basics -->
			<tokencontrol name="token">
				<bounds>33,6,23,23</bounds>
				<empty>indicator_emptytoken</empty>
				<script file="scripts/combattracker_token.lua" />
			</tokencontrol>
			
			<stringcontrol name="name">
				<anchored>
					<to>token</to>
					<position>righthigh</position>
					<offset>1,5</offset>
					<size>
						<width>90</width>
						<height>20</height>
					</size>
				</anchored>
				<font>sheettextsmall</font>
				<frame>
					<name>textline</name>
					<offset>0,1,0,0</offset>
				</frame>
				<script>
					function onValueChanged()
						window.token.setName(getValue());
						window.nameChanged();
					end
					
					function onDrag(button, x, y, draginfo)
						draginfo.setType("combattrackerentry");
						draginfo.setStringData(getValue());
						draginfo.setCustomData(window);
						return true;
					end
					
					function onInit()
						setHoverCursor("hand");
					end

					function onLinkUpdated(source)
						setValue(source.getValue());
					end
					
					function setLink(dbnode)
						if dbnode then
							linknode = dbnode;
							linknode.onUpdate = onLinkUpdated;
							onLinkUpdated(linknode);
							
							addBitmapWidget("indicator_linked").setPosition("bottomright", -5, -7);
						end
					end
				</script>
			</stringcontrol>
			
			<numbercontrol name="initresult">
				<anchored>
					<to>name</to>
					<position>righthigh</position>
					<offset>4,-5</offset>
					<size>
						<width>34</width>
						<height>23</height>
					</size>
				</anchored>
				<hideonvalue>0</hideonvalue>
				<font>sheetnumbersmall</font>
				<frame>
					<name>bonus</name>
					<offset>2,2,2,2</offset>
				</frame>
				<keyeditframe>
					<name>sheetfocus</name>
					<offset>2,2,2,2</offset>
				</keyeditframe>
				<script>
					function onValueChanged()
						window.windowlist.applySort();
					end
				</script>
			</numbercontrol>
			<numbercontrol name="hp">
				<anchored>
					<to>initresult</to>
					<position>right</position>
					<offset>5,0</offset>
					<size>
						<width>34</width>
					</size>
				</anchored>
				<font>sheetnumbersmall</font>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<script>
					function onLinkUpdated(source)
						setValue(source.getValue());
					end
					
					function onValueChanged()
						if linknode then
							linknode.setValue(getValue());
						end
					end
				
					function setLink(dbnode)
						if dbnode then
							linknode = dbnode;
							linknode.onUpdate = onLinkUpdated;
							onLinkUpdated(linknode);
							
							addBitmapWidget("indicator_linked").setPosition("bottomright", -5, -5);
						end
					end
				</script>
			</numbercontrol>
			<numbercontrol name="wounds">
				<anchored>
					<to>hp</to>
					<position>right</position>
					<offset>0,0</offset>
					<size>
						<width>34</width>
					</size>
				</anchored>
				<hideonvalue value="0" />
				<font>sheetnumbersmall</font>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<script>
					function onDrop(x, y, draginfo)
						if draginfo.getType() == "number" then
							if linknode then
								linknode.setValue(getValue() + draginfo.getNumberData());
							else
								setValue(getValue() + draginfo.getNumberData());
							end
						end
						
						return true;
					end

					function onLinkUpdated(source)
						setValue(source.getValue());
					end
					
					function onValueChanged()
						if linknode then
							linknode.setValue(getValue());
						end
					end
				
					function setLink(dbnode)
						if dbnode then
							linknode = dbnode;
							linknode.onUpdate = onLinkUpdated;
							onLinkUpdated(linknode);
							
							addBitmapWidget("indicator_linked").setPosition("bottomright", -5, -5);
						end
					end
				</script>
			</numbercontrol>
			
			<numbercontrol name="space">
				<anchored>
					<to>wounds</to>
					<position>right</position>
					<offset>28,0</offset>
					<size>
						<width>34</width>
					</size>
				</anchored>
				<hideonvalue value="0" />
				<font>sheetnumbersmall</font>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<script>
					function onInit()
						setValue(5);
					end
					
					function onValueChanged()
						window.token.updateUnderlay();
					end
				</script>
			</numbercontrol>
			<numbercontrol name="reach">
				<anchored>
					<to>space</to>
					<position>right</position>
					<offset>25,0</offset>
					<size>
						<width>34</width>
					</size>
				</anchored>
				<hideonvalue value="0" />
				<font>sheetnumbersmall</font>
				<frame>
					<name>modifier</name>
					<offset>2,2,2,2</offset>
				</frame>
				<script>
					function onInit()
						setValue(5);
					end
					
					function onValueChanged()
						window.token.updateUnderlay();
					end
				</script>
			</numbercontrol>
			<genericcontrol>
				<anchored>
					<to>space</to>
					<position>left</position>
					<offset>2,0</offset>
					<size>
						<width>18</width>
					</size>
				</anchored>
				<icon>indicator_space</icon>
			</genericcontrol>
			<genericcontrol>
				<anchored>
					<to>reach</to>
					<position>left</position>
					<offset>2,0</offset>
					<size>
						<width>18</width>
					</size>
				</anchored>
				<icon>indicator_reach</icon>
			</genericcontrol>

			<windowreferencecontrol name="link">
				<anchored>
					<right>
						<anchor>right</anchor>
						<offset>-6</offset>
					</right>
					<top>
						<anchor>top</anchor>
						<offset>7</offset>
					</top>
					<size>
						<width>20</width>
						<height>20</height>
					</size>
				</anchored>
				<icon>
					<normal>button_dragtarget</normal>
				</icon>
				<class>npc</class>
				<invisible />
			</windowreferencecontrol>
			<buttoncontrol name="activateeffects">
				<anchored>
					<right>
						<anchor>right</anchor>
						<offset>-29</offset>
					</right>
					<top>
						<parent>link</parent>
						<anchor>top</anchor>
					</top>
					<size>
						<width>20</width>
						<height>21</height>
					</size>
				</anchored>
				<icon>
					<normal>indicator_effect</normal>
					<pressed>indicator_effect</pressed>
				</icon>
				<script>
					function onButtonPress()
						window.toggleForceEffects();
					end

					function onHover(oncontrol)
						window.setEffectsVisible(oncontrol);
					end
					
					function onInit()
						setColor("7fffffff");
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="activateactive">
				<anchored>
					<right>
						<parent>activateeffects</parent>
						<anchor>left</anchor>
					</right>
					<top>
						<parent>link</parent>
						<anchor>top</anchor>
					</top>
					<size>
						<width>20</width>
						<height>21</height>
					</size>
				</anchored>
				<icon>
					<normal>indicator_sword</normal>
					<pressed>indicator_sworddown</pressed>
				</icon>
				<script>
					function onButtonPress()
						window.toggleForceActive();
					end

					function onHover(oncontrol)
						window.setActiveVisible(oncontrol);
					end
					
					function onInit()
						setColor("7fffffff");
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="activatedefensive">
				<anchored>
					<right>
						<parent>activateactive</parent>
						<anchor>left</anchor>
					</right>
					<top>
						<parent>link</parent>
						<anchor>top</anchor>
					</top>
					<size>
						<width>20</width>
						<height>21</height>
					</size>
				</anchored>
				<icon>
					<normal>indicator_shield</normal>
					<pressed>indicator_shielddown</pressed>
				</icon>
				<script>
					function onButtonPress()
						window.toggleForceDefensive();
					end

					function onHover(oncontrol)
						window.setDefensiveVisible(oncontrol);
					end
					
					function onInit()
						setColor("7fffffff");
					end
				</script>
			</buttoncontrol>

			<genericcontrol name="friendfoe">
				<anchored>
					<right>
						<parent>activatedefensive</parent>
						<anchor>left</anchor>
						<offset>-8</offset>
					</right>
					<top>
						<parent>link</parent>
						<anchor>top</anchor>
						<offset>1</offset>
					</top>
					<size>
						<width>20</width>
						<height>20</height>
					</size>
				</anchored>
				<icon>indicator_ctffempty</icon>
				<stateicons>
					<friend>indicator_ctfffriend</friend>
					<neutral>indicator_ctffneutral</neutral>
					<foe>indicator_ctfffoe</foe>
				</stateicons>
				<script>
					function onDrop(x, y, draginfo)
						if draginfo.isType("combattrackerff") then
							state = draginfo.getStringData();
							window.setFoF(state);
							setIcon(stateicons[1][state][1]);
						end
					end
					
					function setState(s)
						state = s;
						window.setFoF(state);
						if stateicons[1][state] then
							setIcon(stateicons[1][state][1]);
						else
							setIcon(icon[1]);
						end
					end
				</script>
			</genericcontrol>


			<!-- Defensive -->
			<genericcontrol name="defensiveicon">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>48</offset>
					</left>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>20</width>
						<height>21</height>
					</size>
				</anchored>
				<icon>indicator_shield</icon>
			</genericcontrol>

			<genericcontrol name="targeting">
				<anchored>
					<right>
						<anchor>right</anchor>
						<offset>-6</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>100</width>
						<height>20</height>
					</size>
				</anchored>
				<iconspacing>21</iconspacing>
				<script file="scripts/combattracker_targeting.lua" />
			</genericcontrol>

			<numbercontrol name="willsave">
				<anchored>
					<right>
						<parent>targeting</parent>
						<anchor>left</anchor>
						<offset>-5</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>25</width>
						<height>15</height>
					</size>
				</anchored>
				<font>sheetnumbersmall</font>
				<displaysign />
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
				<description>
					<text>Will save</text>
				</description>
				<script>
					function onLinkUpdated(source)
						setValue(source.getValue());
					end
					
					function setLink(dbnode)
						if dbnode then
							linknode = dbnode;
							linknode.onUpdate = onLinkUpdated;
							onLinkUpdated(linknode);
							
							addBitmapWidget("indicator_linked").setPosition("bottomright", 0, -3);

							setReadOnly(true);
						end
					end
				</script>
			</numbercontrol>
			<stringcontrol name="willsavelabel">
				<anchored>
					<right>
						<parent>willsave</parent>
						<anchor>left</anchor>
						<offset>-3</offset>
					</right>
					<top>
						<parent>willsave</parent>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>W</static>
			</stringcontrol>
			<numbercontrol name="reflexsave">
				<anchored>
					<right>
						<parent>willsavelabel</parent>
						<anchor>left</anchor>
						<offset>-5</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>25</width>
						<height>15</height>
					</size>
				</anchored>
				<font>sheetnumbersmall</font>
				<displaysign />
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
				<description>
					<text>Reflex save</text>
				</description>
				<script>
					function onLinkUpdated(source)
						setValue(source.getValue());
					end
					
					function setLink(dbnode)
						if dbnode then
							linknode = dbnode;
							linknode.onUpdate = onLinkUpdated;
							onLinkUpdated(linknode);
							
							addBitmapWidget("indicator_linked").setPosition("bottomright", 0, -3);

							setReadOnly(true);
						end
					end
				</script>
			</numbercontrol>
			<stringcontrol name="reflexsavelabel">
				<anchored>
					<right>
						<parent>reflexsave</parent>
						<anchor>left</anchor>
						<offset>-3</offset>
					</right>
					<top>
						<parent>willsave</parent>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>R</static>
			</stringcontrol>
			<numbercontrol name="fortitudesave">
				<anchored>
					<right>
						<parent>reflexsavelabel</parent>
						<anchor>left</anchor>
						<offset>-5</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>25</width>
						<height>15</height>
					</size>
				</anchored>
				<font>sheetnumbersmall</font>
				<displaysign />
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
				<description>
					<text>Fortitude save</text>
				</description>
				<script>
					function onLinkUpdated(source)
						setValue(source.getValue());
					end
					
					function setLink(dbnode)
						if dbnode then
							linknode = dbnode;
							linknode.onUpdate = onLinkUpdated;
							onLinkUpdated(linknode);
							
							addBitmapWidget("indicator_linked").setPosition("bottomright", 0, -3);

							setReadOnly(true);
						end
					end
				</script>
			</numbercontrol>
			<stringcontrol name="fortitudesavelabel">
				<anchored>
					<right>
						<parent>fortitudesave</parent>
						<anchor>left</anchor>
						<offset>-3</offset>
					</right>
					<top>
						<parent>willsave</parent>
						<anchor>top</anchor>
						<offset>3</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>F</static>
			</stringcontrol>

			<stringcontrol name="ac">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>35</offset>
					</left>
					<right>
						<parent>fortitudesavelabel</parent>
						<anchor>left</anchor>
						<offset>-8</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>relative</relation>
					</top>
				</anchored>
				<font>sheettextsmall</font>
				<multilinespacing>14</multilinespacing>
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
				<script>
					function onLinkUpdated()
						local value = "";
					
						if acnode then
							value = value .. acnode.getValue();
						end
						if touchnode then
							value = value .. ", touch " .. touchnode.getValue();
						end
						if flatfootednode then
							value = value .. ", flatfooted " .. flatfootednode.getValue();
						end
						
						setValue(value);
					end
					
					function onValueChanged()
						if linknode then
							linknode.setValue(getValue());
						end
					end
				
					function setLink(ac, touch, flatfooted)
						if ac or touch or flatfooted then
							acnode = ac;
							touchnode = touch;
							flatfootednode = flatfooted;
							
							acnode.onUpdate = onLinkUpdated;
							touchnode.onUpdate = onLinkUpdated;
							flatfootednode.onUpdate = onLinkUpdated;
							onLinkUpdated();
							
							addBitmapWidget("indicator_linked").setPosition("bottomright", -5, -5);
							
							setReadOnly(true);
						end
					end
				</script>
			</stringcontrol>
			<stringcontrol name="aclabel">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>10</offset>
					</left>
					<top>
						<parent>ac</parent>
						<anchor>top</anchor>
						<offset>4</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>AC</static>
			</stringcontrol>

			<!-- Active -->
			<genericcontrol name="activeicon">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>48</offset>
					</left>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>20</width>
						<height>21</height>
					</size>
				</anchored>
				<icon>indicator_sword</icon>
			</genericcontrol>

			<stringcontrol name="speed">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>35</offset>
					</left>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>40</width>
						<height>17</height>
					</size>
				</anchored>
				<font>sheettextsmall</font>
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
			</stringcontrol>
			<stringcontrol name="speedlabel">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>10</offset>
					</left>
					<top>
						<parent>speed</parent>
						<anchor>top</anchor>
						<offset>4</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Spd</static>
			</stringcontrol>

			<stringcontrol name="atk">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>122</offset>
					</left>
					<right>
						<anchor>right</anchor>
						<offset>-7</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>relative</relation>
					</top>
				</anchored>
				<font>sheettextsmall</font>
				<multilinespacing>14</multilinespacing>
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
				<script file="scripts/npcattackfield.lua" />
			</stringcontrol>
			<stringcontrol name="atklabel">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>82</offset>
					</left>
					<top>
						<parent>atk</parent>
						<anchor>top</anchor>
						<offset>4</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Atk</static>
			</stringcontrol>

			<stringcontrol name="fullatk">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>122</offset>
					</left>
					<right>
						<anchor>right</anchor>
						<offset>-7</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>relative</relation>
					</top>
				</anchored>
				<font>sheettextsmall</font>
				<multilinespacing>14</multilinespacing>
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
				<script file="scripts/npcattackfield.lua" />
			</stringcontrol>
			<stringcontrol name="fullatklabel">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>82</offset>
					</left>
					<top>
						<parent>fullatk</parent>
						<anchor>top</anchor>
						<offset>4</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Full atk</static>
			</stringcontrol>

			<numbercontrol name="init">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>35</offset>
					</left>
					<top>
						<parent>speed</parent>
						<anchor>bottom</anchor>
						<offset>1</offset>
					</top>
					<size>
						<width>40</width>
						<height>15</height>
					</size>
				</anchored>
				<font>sheetnumbersmall</font>
				<displaysign />
				<frame>
					<name>textlinesmall</name>
					<offset>0,-1,0,0</offset>
				</frame>
			</numbercontrol>
			<stringcontrol name="initlabel">
				<anchored>
					<left>
						<parent>name</parent>
						<anchor>left</anchor>
						<offset>10</offset>
					</left>
					<top>
						<parent>init</parent>
						<anchor>top</anchor>
						<offset>4</offset>
					</top>
				</anchored>
				<font>sheetlabelsmall</font>
				<static>Init</static>
			</stringcontrol>

			<!-- Effects -->
			<genericcontrol name="effecticon">
				<anchored>
					<left>
						<anchor>left</anchor>
						<offset>48</offset>
					</left>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<size>
						<width>20</width>
						<height>21</height>
					</size>
				</anchored>
				<icon>indicator_effect</icon>
			</genericcontrol>
			<windowlist name="effects">
				<anchored>
					<left>
						<parent>effecticon</parent>
						<anchor>right</anchor>
					</left>
					<right>
						<anchor>right</anchor>
						<offset>-7</offset>
					</right>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>relative</relation>
					</top>
				</anchored>
				<class>combattracker_effect</class>
				<columns>
					<width>144</width>
					<fillwidth />
				</columns>
				<script file="scripts/combattracker_effects.lua" />
			</windowlist>

			<!-- Spacer -->
			<genericcontrol name="spacer">
				<anchored>
					<top>
						<parent>name</parent>
						<anchor>bottom</anchor>
						<relation>current</relation>
					</top>
					<left>
						<anchor>left</anchor>
					</left>
					<right>
						<anchor>right</anchor>
					</right>
					<size>
						<height>10</height>
					</size>
				</anchored>
				<invisible />
				<disabled />
			</genericcontrol>

			<genericcontrol name="active">
				<anchored>
					<top>
						<anchor>top</anchor>
					</top>
					<bottom>
						<anchor>bottom</anchor>
					</bottom>
					<left>
						<anchor>left</anchor>
					</left>
					<size>
						<width>33</width>
					</size>
				</anchored>
				<icon>indicator_ctpassive</icon>
				<activeicon>indicator_ctactive</activeicon>
				<script file="scripts/combattracker_active.lua" />
			</genericcontrol>
		</sheetdata>
	</windowclass>

	<windowclass name="combattracker">
		<frame>ctbox</frame>
		<placement>
			<size>
				<width>527</width>
				<height>512</height>
			</size>
		</placement>
		<sizelimits>
			<minimum>
				<height>210</height>
			</minimum>
			<dynamic>
				<resize>vertical</resize>
			</dynamic>
		</sizelimits>
		<sheetdata>
			<stringcontrol>
				<bounds>60,15,30,10</bounds>
				<font>sheetlabelsmall</font>
				<color>#ffffffff</color>
				<static>Name</static>
			</stringcontrol>
			<stringcontrol>
				<bounds>158,15,20,10</bounds>
				<font>sheetlabelsmall</font>
				<color>#ffffffff</color>
				<static>Init</static>
			</stringcontrol>
			<stringcontrol>
				<bounds>200,15,20,10</bounds>
				<font>sheetlabelsmall</font>
				<color>#ffffffff</color>
				<static>HP</static>
			</stringcontrol>
			<stringcontrol>
				<bounds>220,15,40,10</bounds>
				<font>sheetlabelsmall</font>
				<color>#ffffffff</color>
				<static>Wounds</static>
			</stringcontrol>

			<windowlist name="list">
				<class>combattracker_entry</class>
				<allowcreate />
				<allowdelete />
				<bounds>0,30,-20,-50</bounds>

				<acceptdrop class="mini_charsheet" fields="name,#hp,#wounds" />
				<acceptdrop class="charsheet" fields="name,#hp,#wounds" />
				<acceptdrop class="npc" fields="name,hp" />
				<acceptdrop class="monster" fields="name,hp" />
				
				<script file="scripts/combattracker.lua" />
			</windowlist>

			<scrollercontrol>
				<anchored>
					<to>list</to>
					<position>insidebottomright</position>
					<size>
						<width>45</width>
						<height>27</height>
					</size>
				</anchored>
				<target>list</target>
				<button>
					<normal>button_scroller</normal>
					<pressed>button_scroller_down</pressed>
				</button>
			</scrollercontrol>
			
			<genericcontrol>
				<bounds>28,-53,33,40</bounds>
				<activeicon>indicator_ctactive</activeicon>
				<script>
					function onInit()
						widget = addBitmapWidget(activeicon[1]);
						setHoverCursor("hand");
					end
					
					function onDrag(button, x, y, draginfo)
						draginfo.setType("combattrackeractivation");
						draginfo.setIcon(activeicon[1]);
						widget.setVisible(false);
						
						return true;
					end
					
					function onDragEnd(draginfo)
						widget.setVisible(true);
					end
				</script>
			</genericcontrol>
			<buttoncontrol>
				<bounds>62,-45,33,26</bounds>
				<icon>
					<normal>button_ctnextactor</normal>
					<pressed>button_ctnextactor_down</pressed>
				</icon>
				<tooltip>
					<text>Next actor</text>
				</tooltip>
				<script>
					function onButtonPress()
						window.list.nextActor();
					end
					
					function onDrag(button, x, y, draginfo)
						draginfo.setType("combattrackernextactor");
						draginfo.setIcon(icon[1].normal[1]);
						return true;
					end
				</script>
			</buttoncontrol>

			<combattrackerffsource>
				<bounds>200,-43,20,20</bounds>
				<icon>indicator_ctfffriend</icon>
				<value>friend</value>
				<tooltip>
					<text>Friendly</text>
				</tooltip>
			</combattrackerffsource>
			<combattrackerffsource>
				<bounds>227,-43,20,20</bounds>
				<icon>indicator_ctffneutral</icon>
				<value>neutral</value>
				<tooltip>
					<text>Neutral</text>
				</tooltip>
			</combattrackerffsource>
			<combattrackerffsource>
				<bounds>254,-43,20,20</bounds>
				<icon>indicator_ctfffoe</icon>
				<value>foe</value>
				<tooltip>
					<text>Hostile</text>
				</tooltip>
			</combattrackerffsource>
			
			<stringcontrol name="roundcounterlabel">
				<bounds>360,-39,50,15</bounds>
				<font>sheetlabel</font>
				<color>#ffffffff</color>
				<static>Round</static>
			</stringcontrol>
			<numbercontrol name="roundcounter">
				<anchored>
					<to>roundcounterlabel</to>
					<position>righthigh</position>
					<offset>0,-6</offset>
					<size>
						<width>40</width>
						<height>25</height>
					</size>
				</anchored>
				<frame>
					<name>modifier</name>
					<offset>3,3,3,3</offset>
				</frame>
				<font>sheetnumber</font>
			</numbercontrol>
			<buttoncontrol>
				<anchored>
					<to>roundcounter</to>
					<position>righthigh</position>
					<offset>5,0</offset>
					<size>
						<width>33</width>
						<height>26</height>
					</size>
				</anchored>
				<icon>
					<normal>button_ctnextround</normal>
					<pressed>button_ctnextround_down</pressed>
				</icon>
				<tooltip>
					<text>Next round</text>
				</tooltip>
				<script>
					function onButtonPress()
						window.list.nextRound();
					end
					
					function onDrag(button, x, y, draginfo)
						draginfo.setType("combattrackernextround");
						draginfo.setIcon(icon[1].normal[1]);
						return true;
					end
				</script>
			</buttoncontrol>
		</sheetdata>
	</windowclass>
</root>
